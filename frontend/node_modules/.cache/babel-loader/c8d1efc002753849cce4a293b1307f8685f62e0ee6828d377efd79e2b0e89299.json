{"ast":null,"code":"import React,{useState,useEffect}from'react';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const GameStateInitial=_ref=>{let{userList,displayName,eventSource}=_ref;const[board,setBoard]=useState([]);const[revealedCells,setRevealedCells]=useState([]);const[currentPlayer,setCurrentPlayer]=useState(null);const[scores,setScores]=useState({});useEffect(()=>{console.log(\"useEffect triggered with displayName:\",displayName);if(eventSource){eventSource.onmessage=event=>{console.log(\"Event received:\",event.data);// Log any event received\nconst data=JSON.parse(event.data);if(data.type==='boardUpdate'){console.log(\"Board update received:\",data.board,data.revealedCells,data.scores);// Log the board update\nsetBoard(data.board);setRevealedCells(data.revealedCells);setScores(data.scores);}else if(data.type==='currentPlayer'){console.log(\"Current player update received:\",data.displayName);// Log the current player update\nsetCurrentPlayer(data.displayName);}else if(data.type==='scoreUpdate'){console.log(\"Score update received:\",data.scores);// Log the score update\nsetScores(data.scores);}// Handle other event types if needed\n};eventSource.onerror=error=>{console.error(\"EventSource failed:\",error);eventSource.close();};}},[displayName,eventSource]);useEffect(()=>{console.log(\"All clients loaded\");},[userList]);useEffect(()=>{// Fetch the initial board from the server\nfetch(\"/generate-board\").then(response=>response.json()).then(data=>{console.log(\"Fetched initial board:\",data.board);setBoard(data.board);setRevealedCells(Array.from({length:data.board.length},()=>Array(data.board[0].length).fill(false)));}).catch(error=>console.error(\"Error fetching initial board:\",error));// Fetch the initial player from the server\nfetch(\"/initial-player\").then(response=>response.json()).then(data=>{console.log(\"Fetched initial player:\",data.displayName);setCurrentPlayer(data.displayName);}).catch(error=>console.error(\"Error fetching initial player:\",error));// Fetch the initial scores from the server\nfetch(\"/initial-scores\").then(response=>response.json()).then(data=>{console.log(\"Fetched initial scores:\",data.scores);setScores(data.scores);}).catch(error=>console.error(\"Error fetching initial scores:\",error));},[]);const handleCellClick=(rowIndex,colIndex)=>{if(revealedCells[rowIndex][colIndex]||currentPlayer!==displayName)return;// Prevent clicking on the same cell more than once or if it's not the player's turn\nconst newRevealedCells=revealedCells.map((row,rIdx)=>row.map((cell,cIdx)=>rIdx===rowIndex&&cIdx===colIndex?true:cell));setRevealedCells(newRevealedCells);const isMine=board[rowIndex][colIndex]==='M';// Assuming 'M' represents a mine\nconst scoreChange=isMine?-1:1;const newScores={...scores,[displayName]:(scores[displayName]||0)+scoreChange};setScores(newScores);console.log(\"Sending updated board state and scores to server:\",board,newRevealedCells,newScores);// Log the updated board state and scores\n// Send the updated board state and scores to the server\nfetch(\"/update-board\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({board,revealedCells:newRevealedCells,scores:newScores,displayName})}).catch(error=>console.error(\"Error updating board:\",error));};return/*#__PURE__*/_jsxs(\"div\",{className:\"hero center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"user-grid\",children:userList.filter(user=>user.displayName).map(user=>/*#__PURE__*/_jsx(\"div\",{className:\"user-card-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"user-card\",children:[user.displayName,\" \",user.displayName===displayName&&\"(You)\",/*#__PURE__*/_jsxs(\"div\",{children:[\"Score: \",scores[user.displayName]||0]})]})},user.displayName))}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"board\",children:board.map((row,rowIndex)=>/*#__PURE__*/_jsx(\"div\",{className:\"board-row\",children:row.map((cell,colIndex)=>/*#__PURE__*/_jsx(\"div\",{className:\"board-cell\",onClick:()=>handleCellClick(rowIndex,colIndex),children:revealedCells[rowIndex][colIndex]?cell:''},colIndex))},rowIndex))})]});};export default GameStateInitial;","map":{"version":3,"names":["React","useState","useEffect","jsxs","_jsxs","jsx","_jsx","GameStateInitial","_ref","userList","displayName","eventSource","board","setBoard","revealedCells","setRevealedCells","currentPlayer","setCurrentPlayer","scores","setScores","console","log","onmessage","event","data","JSON","parse","type","onerror","error","close","fetch","then","response","json","Array","from","length","fill","catch","handleCellClick","rowIndex","colIndex","newRevealedCells","map","row","rIdx","cell","cIdx","isMine","scoreChange","newScores","method","headers","body","stringify","className","children","filter","user","onClick"],"sources":["/Users/jq/VSC/The-Retro-Retro-Game/frontend/src/components/GameStateInitial.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\nconst GameStateInitial = ({ userList, displayName, eventSource }) => {\n    const [board, setBoard] = useState([]);\n    const [revealedCells, setRevealedCells] = useState([]);\n    const [currentPlayer, setCurrentPlayer] = useState(null);\n    const [scores, setScores] = useState({});\n\n    useEffect(() => {\n        console.log(\"useEffect triggered with displayName:\", displayName);\n\n        if (eventSource) {\n            eventSource.onmessage = (event) => {\n                console.log(\"Event received:\", event.data); // Log any event received\n                const data = JSON.parse(event.data);\n                if (data.type === 'boardUpdate') {\n                    console.log(\"Board update received:\", data.board, data.revealedCells, data.scores); // Log the board update\n                    setBoard(data.board);\n                    setRevealedCells(data.revealedCells);\n                    setScores(data.scores);\n                } else if (data.type === 'currentPlayer') {\n                    console.log(\"Current player update received:\", data.displayName); // Log the current player update\n                    setCurrentPlayer(data.displayName);\n                } else if (data.type === 'scoreUpdate') {\n                    console.log(\"Score update received:\", data.scores); // Log the score update\n                    setScores(data.scores);\n                }\n                // Handle other event types if needed\n            };\n\n            eventSource.onerror = (error) => {\n                console.error(\"EventSource failed:\", error);\n                eventSource.close();\n            };\n        }\n    }, [displayName, eventSource]);\n\n    useEffect(() => {\n        console.log(\"All clients loaded\");\n    }, [userList]);\n\n    useEffect(() => {\n        // Fetch the initial board from the server\n        fetch(\"/generate-board\")\n            .then(response => response.json())\n            .then(data => {\n                console.log(\"Fetched initial board:\", data.board);\n                setBoard(data.board);\n                setRevealedCells(Array.from({ length: data.board.length }, () => Array(data.board[0].length).fill(false)));\n            })\n            .catch(error => console.error(\"Error fetching initial board:\", error));\n\n        // Fetch the initial player from the server\n        fetch(\"/initial-player\")\n            .then(response => response.json())\n            .then(data => {\n                console.log(\"Fetched initial player:\", data.displayName);\n                setCurrentPlayer(data.displayName);\n            })\n            .catch(error => console.error(\"Error fetching initial player:\", error));\n\n        // Fetch the initial scores from the server\n        fetch(\"/initial-scores\")\n            .then(response => response.json())\n            .then(data => {\n                console.log(\"Fetched initial scores:\", data.scores);\n                setScores(data.scores);\n            })\n            .catch(error => console.error(\"Error fetching initial scores:\", error));\n    }, []);\n\n    const handleCellClick = (rowIndex, colIndex) => {\n        if (revealedCells[rowIndex][colIndex] || currentPlayer !== displayName) return; // Prevent clicking on the same cell more than once or if it's not the player's turn\n\n        const newRevealedCells = revealedCells.map((row, rIdx) => \n            row.map((cell, cIdx) => (rIdx === rowIndex && cIdx === colIndex ? true : cell))\n        );\n        setRevealedCells(newRevealedCells);\n\n        const isMine = board[rowIndex][colIndex] === 'M'; // Assuming 'M' represents a mine\n        const scoreChange = isMine ? -1 : 1;\n        const newScores = { ...scores, [displayName]: (scores[displayName] || 0) + scoreChange };\n        setScores(newScores);\n\n        console.log(\"Sending updated board state and scores to server:\", board, newRevealedCells, newScores); // Log the updated board state and scores\n\n        // Send the updated board state and scores to the server\n        fetch(\"/update-board\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({ board, revealedCells: newRevealedCells, scores: newScores, displayName }),\n        }).catch(error => console.error(\"Error updating board:\", error));\n    };\n\n    return (\n        <div className=\"hero center\">\n            <div className=\"user-grid\">\n                {userList.filter(user => user.displayName).map(user => (\n                    <div key={user.displayName} className=\"user-card-container\">\n                        <div className=\"user-card\">\n                            {user.displayName} {user.displayName === displayName && \"(You)\"}\n                            <div>Score: {scores[user.displayName] || 0}</div>\n                        </div>\n                    </div>\n                ))}\n            </div>\n            <br />\n            <div className=\"board\">\n                {board.map((row, rowIndex) => (\n                    <div key={rowIndex} className=\"board-row\">\n                        {row.map((cell, colIndex) => (\n                            <div \n                                key={colIndex} \n                                className=\"board-cell\" \n                                onClick={() => handleCellClick(rowIndex, colIndex)}\n                            >\n                                {revealedCells[rowIndex][colIndex] ? cell : ''}\n                            </div>\n                        ))}\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n};\n\nexport default GameStateInitial;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
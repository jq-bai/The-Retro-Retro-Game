{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const GameStateInitial=_ref=>{let{userList,displayName}=_ref;const eventSourceRef=useRef(null);const[board,setBoard]=useState([]);useEffect(()=>{console.log(\"useEffect triggered with displayName:\",displayName);if(!eventSourceRef.current&&displayName){console.log(\"Creating new EventSource for displayName:\",displayName);const eventSource=new EventSource(`/events?displayName=${displayName}`);eventSourceRef.current=eventSource;eventSource.onmessage=event=>{console.log(\"Event received:\",event.data);// Log any event received\nconst data=JSON.parse(event.data);if(data.type==='boardUpdate'){console.log(\"Board update received:\",data.board);// Log the board update\nsetBoard(data.board);}// Handle other event types if needed\n};eventSource.onerror=error=>{console.error(\"EventSource failed:\",error);eventSource.close();eventSourceRef.current=null;};return()=>{console.log(\"Closing EventSource\");eventSource.close();eventSourceRef.current=null;};}},[displayName]);useEffect(()=>{console.log(\"All clients loaded\");},[userList]);useEffect(()=>{// Fetch the initial board from the server\nfetch(\"/generate-board\").then(response=>response.json()).then(data=>{console.log(\"Fetched initial board:\",data.board);setBoard(data.board);}).catch(error=>console.error(\"Error fetching initial board:\",error));},[]);const handleCellClick=(rowIndex,colIndex)=>{const newBoard=board.map((row,rIdx)=>row.map((cell,cIdx)=>rIdx===rowIndex&&cIdx===colIndex?'X':cell));setBoard(newBoard);console.log(\"Sending updated board state to server:\",newBoard);// Log the updated board state\n// Send the updated board state to the server\nfetch(\"/update-board\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({board:newBoard})}).catch(error=>console.error(\"Error updating board:\",error));};return/*#__PURE__*/_jsxs(\"div\",{className:\"hero center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"user-grid\",children:userList.filter(user=>user.displayName).map(user=>/*#__PURE__*/_jsx(\"div\",{className:\"user-card-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"user-card\",children:user.displayName})},user.displayName))}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"board\",children:board.map((row,rowIndex)=>/*#__PURE__*/_jsx(\"div\",{className:\"board-row\",children:row.map((cell,colIndex)=>/*#__PURE__*/_jsx(\"div\",{className:\"board-cell\",onClick:()=>handleCellClick(rowIndex,colIndex),children:cell},colIndex))},rowIndex))})]});};const generateBoard=(rows,cols)=>{return Array.from({length:rows},()=>Array.from({length:cols},()=>''));};export default GameStateInitial;","map":{"version":3,"names":["React","useState","useEffect","useRef","jsx","_jsx","jsxs","_jsxs","GameStateInitial","_ref","userList","displayName","eventSourceRef","board","setBoard","console","log","current","eventSource","EventSource","onmessage","event","data","JSON","parse","type","onerror","error","close","fetch","then","response","json","catch","handleCellClick","rowIndex","colIndex","newBoard","map","row","rIdx","cell","cIdx","method","headers","body","stringify","className","children","filter","user","onClick","generateBoard","rows","cols","Array","from","length"],"sources":["/Users/baijianqing/VSC/The-Retro-Retro-Game/frontend/src/components/GameStateInitial.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\n\nconst GameStateInitial = ({ userList, displayName }) => {\n    const eventSourceRef = useRef(null);\n    const [board, setBoard] = useState([]);\n\n    useEffect(() => {\n        console.log(\"useEffect triggered with displayName:\", displayName);\n\n        if (!eventSourceRef.current && displayName) {\n            console.log(\"Creating new EventSource for displayName:\", displayName);\n            const eventSource = new EventSource(`/events?displayName=${displayName}`);\n            eventSourceRef.current = eventSource;\n\n            eventSource.onmessage = (event) => {\n                console.log(\"Event received:\", event.data); // Log any event received\n                const data = JSON.parse(event.data);\n                if (data.type === 'boardUpdate') {\n                    console.log(\"Board update received:\", data.board); // Log the board update\n                    setBoard(data.board);\n                }\n                // Handle other event types if needed\n            };\n\n            eventSource.onerror = (error) => {\n                console.error(\"EventSource failed:\", error);\n                eventSource.close();\n                eventSourceRef.current = null;\n            };\n\n            return () => {\n                console.log(\"Closing EventSource\");\n                eventSource.close();\n                eventSourceRef.current = null;\n            };\n        }\n    }, [displayName]);\n\n    useEffect(() => {\n        console.log(\"All clients loaded\");\n    }, [userList]);\n\n    useEffect(() => {\n        // Fetch the initial board from the server\n        fetch(\"/generate-board\")\n            .then(response => response.json())\n            .then(data => {\n                console.log(\"Fetched initial board:\", data.board);\n                setBoard(data.board);\n            })\n            .catch(error => console.error(\"Error fetching initial board:\", error));\n    }, []);\n\n    const handleCellClick = (rowIndex, colIndex) => {\n        const newBoard = board.map((row, rIdx) => \n            row.map((cell, cIdx) => (rIdx === rowIndex && cIdx === colIndex ? 'X' : cell))\n        );\n        setBoard(newBoard);\n\n        console.log(\"Sending updated board state to server:\", newBoard); // Log the updated board state\n\n        // Send the updated board state to the server\n        fetch(\"/update-board\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({ board: newBoard }),\n        }).catch(error => console.error(\"Error updating board:\", error));\n    };\n\n    return (\n        <div className=\"hero center\">\n            <div className=\"user-grid\">\n                {userList.filter(user => user.displayName).map(user => (\n                    <div key={user.displayName} className=\"user-card-container\">\n                        <div className=\"user-card\">\n                            {user.displayName}\n                        </div>\n                    </div>\n                ))}\n            </div>\n            <br />\n            <div className=\"board\">\n                {board.map((row, rowIndex) => (\n                    <div key={rowIndex} className=\"board-row\">\n                        {row.map((cell, colIndex) => (\n                            <div \n                                key={colIndex} \n                                className=\"board-cell\" \n                                onClick={() => handleCellClick(rowIndex, colIndex)}\n                            >\n                                {cell}\n                            </div>\n                        ))}\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n};\n\nconst generateBoard = (rows, cols) => {\n    return Array.from({ length: rows }, () => Array.from({ length: cols }, () => ''));\n};\n\nexport default GameStateInitial;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}